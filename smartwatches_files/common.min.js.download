function pay(){var e=jQuery("#hs-user-phone").val(),t=jQuery("#pay_btn"),n="";if(e)n="&payment_phone="+e;var a=new XMLHttpRequest;a.onreadystatechange=function(){var e=jQuery("#commonname").data("order-id"),n=jQuery("#commonname").data("paybill-shortcode"),a="please try again later",o=t.attr("title");if(t.text(o),e>0)a="Please pay to our Paybill "+n+". The account number is "+e;if(4==this.readyState&&200==this.status){var r=JSON.parse(this.responseText);0==r.rescode?(document.getElementById("commonname").className="waiting_success",window.timer=setInterval(()=>{setTimeout(function(){x()},0)},1e3),document.getElementById("commonname").innerHTML=r.resmsg):(document.getElementById("commonname").className="error",document.getElementById("commonname").innerHTML="M-PESA Express is unreachabe. "+a,t.prop("disabled",!1))}500==this.status&&(document.getElementById("commonname").className="error",document.getElementById("commonname").innerHTML="M-PESA Express is unreachabe. "+a,t.prop("disabled",!1),clearInterval(timer))},a.open("POST",getHost+"/?payment_action=1"+n,!0),a.setRequestHeader("Content-type","application/x-www-form-urlencoded"),a.send("type=STK")}function x(){var e=jQuery("#pay_btn"),t=e.attr("title"),n=new XMLHttpRequest;n.onreadystatechange=function(){if(4==this.readyState&&200==this.status){var n=JSON.parse(this.responseText);0==n.rescode?(document.getElementById("commonname").className="final_success",clearInterval(timer),n.final_location&&(window.location=n.final_location)):9999==n.rescode?document.getElementById("commonname").className="processing":1037==n.rescode||2001==n.rescode?(document.getElementById("commonname").className="error",e.text(t),e.prop("disabled",!1),clearInterval(timer)):(e.text(t),e.prop("disabled",!1),document.getElementById("commonname").className="error"),document.getElementById("commonname").innerHTML=n.resmsg}500==this.status&&(document.getElementById("commonname").className="error",document.getElementById("commonname").innerHTML="An error occured while checking the transaction status",clearInterval(timer))},n.open("POST",getHost+"/?scanner_action=1",!0),n.setRequestHeader("Content-type","application/x-www-form-urlencoded"),n.send()}var getHost=window.location.protocol+"//"+window.location.host;jQuery(function(e){var t=jQuery("#form-confirm-phone");if(t.length>0){var n=jQuery("#pay_btn");n.on("click",function(e){var t=jQuery(this);t.text("Please wait...").prop("disabled",!0);var n=jQuery("#hs-user-phone").val();n&&pay()})}});